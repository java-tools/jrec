useFixture(default)

def test():
	from Modules import commonBits
	java_recorded_version = '1.6.0_03'

	if window('Record Editor'):
		select('FileChooser', commonBits.sampleDir() + 'DTAR020.bin')
		commonBits.setRecordLayout(select, 'DTAR020')
		commonBits.doEdit(click)
		select_menu('View>>Sorted Field Tree')
		select('List', 'DTAR020')
		select('List', 'DTAR020')
		select('Table', 'cell:Field,0( )')
		select('List', 'DTAR020')
		select('Table', 'DEPT-NO', 'Field,0')
		select('Table', 'DATE', 'Field,1')
		select('Table', 'cell:Field,1(DATE)')
		select('Table1', 'cell:Function,3()')
		select('Table', 'cell:Field,1(DATE)')
		select('Table1', 'Maximum', 'Function,3')
		select('Table1', 'Sum', 'Function,4')
		select('Table1', 'Sum', 'Function,5')
		select('Table1', 'cell:Function,5(Sum)')
		click('Build Tree')
		select('JTreeTable', 'cell:DEPT-NO,0(60)')
		assert_p('JTreeTable', 'Text', '60', 'DEPT-NO,0')
		select('JTreeTable', 'cell:SALE-PRICE,0(8.74)')
		assert_p('JTreeTable', 'Text', '8.74', 'SALE-PRICE,0')
		select('JTreeTable', 'cell:SALE-PRICE,1(166.94)')
		assert_p('JTreeTable', 'Text', '87.46', 'SALE-PRICE,2')
		select('JTreeTable', 'cell:SALE-PRICE,2(87.46)')
		assert_p('JTreeTable', 'Text', '87.46', 'SALE-PRICE,2')
		select('JTreeTable', 'cell:DEPT-NO,3(160)')
		assert_p('JTreeTable', 'Text', '160', 'DEPT-NO,3')
		select('JTreeTable', 'cell:QTY-SOLD,3(-1)')
		assert_p('JTreeTable', 'Text', '3', 'QTY-SOLD,4')
		select('JTreeTable', 'cell:QTY-SOLD,1(8)')
		assert_p('JTreeTable', 'Text', '-1', 'QTY-SOLD,3')

		select_menu('File>>Save Tree as XML')

		if window('Open'):
##			select('FilePane$3', 'x1DTAR020.bin.xml')
##			select('File Name', 'x1DTAR020.bin.xml')
			if commonBits.isWindowsLook():
				select(commonBits.selectPane(), 'xx2DTAR020.bin.xml')
			else:
				select('File Name', 'xx2DTAR020.bin.xml')

			click('Open')
		close()

		click('Open')
		select('FileChooser', commonBits.sampleDir() + 'xx2DTAR020.bin.xml')
		commonBits.doEdit(click)
##-------------------------------------------------
		rightclick('JTreeTable', 'Tree,0')
#		select_menu('Fully Expand Tree')
		select_menu('Expand Tree')
		select('LayoutCombo', 'DEPT-NO')

#--------------------------------------------------
		select('JTreeTable', 'cell:DEPT-NO,1(998)')
		select('JTreeTable', 'cell:DEPT-NO,1(998)')
		select('JTreeTable', 'cell:SALE-PRICE,1(2996.75)')
		select('JTreeTable', 'cell:Xml~Prefix,1(null)')
		rightclick('JTreeTable', 'Xml~Prefix,1')
		select_menu('Expand Tree')
		select('JTreeTable', 'cell:SALE-PRICE,1(2996.75)')
		assert_p('JTreeTable', 'Text', '8.44', 'SALE-PRICE,6')
		select('JTreeTable', 'cell:SALE-PRICE,2(8.74)')
		assert_p('JTreeTable', 'Text', '1', 'QTY-SOLD,9')
		select('JTreeTable', 'cell:SALE-PRICE,3(166.94)')
		assert_p('JTreeTable', 'Text', '135.00', 'SALE-PRICE,12')
		select('JTreeTable', 'cell:SALE-PRICE,4(87.46)')
		assert_p('JTreeTable', 'Text', '-4.00', 'SALE-PRICE,11')
		select('JTreeTable', 'cell:Key,5(160)')
		assert_p('JTreeTable', 'Text', '220', 'Key,8')
		select('JTreeTable', 'cell:SALE-PRICE,7(150.26)')
		assert_p('JTreeTable', 'Text', '7', 'QTY-SOLD,13')
		select('JTreeTable', 'cell:Xml~Prefix,2(null)')
		rightclick('JTreeTable', 'Xml~Prefix,2')
		select_menu('Edit Record')
		select('JTreeTable', 'cell:Xml~Prefix,2(null)')
		select('Table', 'cell:Data,6(8.74)')
		assert_p('Table', 'Text', '8.74', 'Data,6')
		select('Table', 'cell:Data,4(60)')
		assert_p('Table', 'Content', '[[Xml~Name, 0, , DEPT-NO, DEPT-NO], [Xml~Prefix, 3, , , ], [Xml~Namespace, 4, , , ], [Key, 5, , 60, 60], [DEPT-NO, 6, , 60, 60], [QTY-SOLD, 7, , 1, 1], [SALE-PRICE, 8, , 8.74, 8.74], [Xml~End, 1, , , ], [Following~Text, 2, , , ]]')
		click('Right')
		select('Table', 'cell:Data,3(40118)')
		select('Table', 'cell:Data,3(40118)')
		assert_p('Table', 'Text', '1', 'Data,5')
		select('Table', 'cell:Data,6(8.74)')
		assert_p('Table', 'Content', '[[Xml~Name, 0, , DATE, DATE], [Xml~Prefix, 3, , , ], [Xml~Namespace, 4, , , ], [Key, 5, , 40118, 40118], [DEPT-NO, 6, , 60, 60], [QTY-SOLD, 7, , 1, 1], [SALE-PRICE, 8, , 8.74, 8.74], [Xml~End, 1, , , ], [Following~Text, 2, , , ]]')
		click('Right')
		select('Table', 'cell:Data,3(60614646)')
		select('Table', 'cell:Data,3(60614646)')
		assert_p('Table', 'Text', '60614646', 'Data,3')
		select('Table', 'cell:Data,5(40118)')
		assert_p('Table', 'Content', '[[Xml~Name, 0, , DTAR020, DTAR020], [Xml~Prefix, 3, , , ], [Xml~Namespace, 4, , , ], [KEYCODE-NO, 5, , 60614646, 60614646], [STORE-NO, 6, , 166, 166], [DATE, 7, , 40118, 40118], [DEPT-NO, 8, , 60, 60], [QTY-SOLD, 9, , 1, 1], [SALE-PRICE, 10, , 6.00, 6.00], [Xml~End, 1, , True, True], [Following~Text, 2, , , ]]')
		click('Right')
		click('Right')
		select('Table', 'cell:Data,3(69644897)')
		select('Table', 'cell:Data,3(69644897)')
		assert_p('Table', 'Text', '166', 'Data,4')
		select('Table', 'cell:Data,5(40118)')
		assert_p('Table', 'Content', '[[Xml~Name, 0, , DTAR020, DTAR020], [Xml~Prefix, 3, , , ], [Xml~Namespace, 4, , , ], [KEYCODE-NO, 5, , 69644897, 69644897], [STORE-NO, 6, , 166, 166], [DATE, 7, , 40118, 40118], [DEPT-NO, 8, , 60, 60], [QTY-SOLD, 9, , 1, 1], [SALE-PRICE, 10, , 5.08, 5.08], [Xml~End, 1, , True, True], [Following~Text, 2, , , ]]')
		select('Table', 'cell:Data,6(60)')
		select('Table', 'cell:Data,6(60)')
		assert_p('Table', 'Text', '1', 'Data,7')
		select('Table', 'cell:Data,6(60)')
		click('Right')
		select('Table', 'cell:Data,3(68654655)')
		select('Table', 'cell:Data,3(68654655)')
		assert_p('Table', 'Content', '[[Xml~Name, 0, , DTAR020, DTAR020], [Xml~Prefix, 3, , , ], [Xml~Namespace, 4, , , ], [KEYCODE-NO, 5, , 68654655, 68654655], [STORE-NO, 6, , 166, 166], [DATE, 7, , 40118, 40118], [DEPT-NO, 8, , 60, 60], [QTY-SOLD, 9, , 1, 1], [SALE-PRICE, 10, , 5.08, 5.08], [Xml~End, 1, , True, True], [Following~Text, 2, , , ]]')
	close()
